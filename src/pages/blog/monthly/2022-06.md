---
title: "月報[2022-06]"
layout: "../../../layouts/BlogPost.astro"
description: ""
date: "2022-11-29"
count: 14592
tags:
 - monthly
---




### === 日記(趣味に真面目に取り組め) ===

[2022-06-11]

# 趣味を逃げ道に使うな

## 今北産業

趣味が仕事へと還元?できれば嬉しいが

複数の目的が混じれば混じるほど複雑かつ重くなるので

趣味に趣味以上の役割を持たせてはいけない。

## これまで

趣味何するか考えるくらいにやることがない時期があった。

その際の指標となるのはやはり仕事だった。

PHPやるのでPHPでコード書いたり、

React採用されるのでReactといった形で趣味の方の指針となるが、

これが問題があった。

## 結果的にやらなくてもよかった

---

？「僕君が入る案件の候補としてはHogeがあるね。言語はFuga、環境はPoyoね」

僕「よし、ならPoyoをdocker-composeで構築してFugaやるぞー。」

---

結果的にその案件には入らない。

会社の都合とかもあるし、そもそも概要だけ聞いて小さな環境でうんこみたいなアプリ書いてなんか意味ある？？？？？？？

## いやそもそもコミュニケーションどうにかしろ問題。

お前は技術力よりもどうにかしたほうがいいことがある。

## 技術的にも中途半端、または無意味

責任があるわけでもないので対して深く掘らない。または仕事とは別の路線へ入ることがほとんどなのでそこまで恩恵はない。

## よくわからない自信がついてしまう

最悪。序盤の警戒心や危機感が少し消える。

## 案件が始まる or 終わったら終わり

結果、ただの中途半端なゴミだけが残る。

## これから

別に趣味で調査、コーディング諸々に手を抜いてもいいと思ってる。

完成品を作らなくても、記事を公開しなくてもいい。

でも楽しむことに対しては言い訳できないくらい全力を尽くすべきだと思った。そこだけは妥協してはいけない。

僕の生きている理由なんて食事とこの趣味楽しむくらいだろ。

# 何をすればよいのかよくわからなくなる

PDCAサイクルを意識してうごいてみる。

頭悪そうな表現だ。

厳密には反省を意識的に行いたい。

これは進捗日報を見直す作業が該当する。

# すーぐtrello見なくなる

さっさと見ろ。

# 土日何して遊ぶ?

## simple csv search

パーティションファイル同時読み実装するくらいかな。

## マイクラ

楽しんだ。


### === 日記(結局何もしなかった土曜日) ===

[2022-06-12]

# 余計なことをするな

昨日を簡単に表現すると「余計なこと考えて勝手に自爆」に尽きる。

強い衝動でもない限りは既存のPJ頑張ろう。

今のメインはCSV検索だ。

残りは細々とやっていく。

# CSV検索

進捗の方で書く。

# 細々

## Arch Linux更新

自宅のArchは4つ(うち一つ予備)あるので毎週終わりには更新作業入れてる。

## 自宅サーバ(ラズパイ)再起動

再起動入れないと重くなったりSwapに溜まったりといろいろあるので再起動かけてる。

また、リポジトリが死んでる？やつとかの調整して一部の端末にupgradeかけた。

## 部屋の掃除

机の上と床と本棚あたりは二週間に一度程度やってる。メンタルが正常なときは週一くらいでやりたい。


### === 日記(友達ができました) ===

[2022-06-13]

# 友達

友達ができました。

蜘蛛です。自室によくきます。気軽にきてくれるのでちょっと嬉しいです。

# 鬱

メンタルが割とやばめです。なんでや。

もし解雇されたらしばらくうんこと昼寝の生活になりそう。

# 独り言

独り言がでてくると仕事にアクセルかかる気がする。

アニメとか流さずに独り言した方がいい。

## そんなことはなかった

結構前から仕事に力が入らない。なんでだろ。

## 遊び

買うほどではないが、ちょっと興味がある本のサンプルコードを妄想する。

目次とか公開されてますよね。それをみて実物を作るやつね。

[Amazon.co.jp - Pythonでつくる ゲーム開発 入門講座 | 廣瀬 豪 |本 | 通販](https://www.amazon.co.jp/Python%E3%81%A7%E3%81%A4%E3%81%8F%E3%82%8B-%E3%82%B2%E3%83%BC%E3%83%A0%E9%96%8B%E7%99%BA-%E5%85%A5%E9%96%80%E8%AC%9B%E5%BA%A7-%E5%BB%A3%E7%80%AC-%E8%B1%AA/dp/4800712394/ref=tmm_hrd_swatch_0?_encoding=UTF8&qid=&sr=)


これやってみる。すぐ飽きるかもしれんけど。

# csv検索

またつまった。しばらく休憩。


### === 日記(辛い) ===

[2022-06-14]


Emacsへfcitx入力できるの嬉しいんだけどめちゃくちゃ入力時にゴミが入るのなんとかしたい。

# 辛い

辛いね。


### === 日記(新しい趣味を探している) ===

[2022-06-16]

久しく冷めていたV視聴再開した。

こよりみてる。OP大好き。全体としてはやはり声が好き。

# JavaScriptで困ってること

```javascript
let [a,_,_,b] = ary;

```

みたいなの書けないんすね。_はすでに使われとるわぼけって怒られた。

仕方ないのでそれぞれ適当な名前つけて対処した。

なんか上手い書き方あるかな。

# 趣味

みたこともない趣味初めるのハードル高すぎることやっと気がついた。

* これから何年生きることができるかわからんが、少なくとも死ぬまで友人が増えることはない。

* Discordとか巡って体感したが、コミュニティに入ることも無理。

* 僕の新しいことへの抵抗値はそれなりに高い。

上記より、多人数きゃっきゃは実現困難であり、基本的に孤独もくもくが前提がほぼ確定している。

その上で考えたいくつか候補がある。

## ゲーム開発

AndroidとかiOSとかだるいので気軽にWebで楽しめるようなゲームを作れたらなとは考えてる。

以後想定している流れ:

1. テトリス作成(今ここ)
2. パズルゲーム作成
3. 横スクロールゲーム作成(超絶劣化マリオとか作れたら...)
4. 横スクロール + @, 今考えてるのは劣化マリオでゲーム内のイベントとAPI叩く処理を連動させてゲームに反映させるやつ。

せめてテトリスは終わらせたいね。

## インフラ

金がない。それは事実だが現状の機材でもやれることはたくさんある。

...が肝心のやりたいことがない。

当然会社の補助金とかあてにできないので(あっても有用な用途をプレゼンできないのだが)

ある程度金銭を消費してAWSあたりで遊び倒すか少し考えてる。

自宅でも検証NWで動いてるやつらはほとんど余っている状態なので、そちらについて考えても良いかも。

ゲーム開発の方でロードマップだしたばっかなのでこちらでだすのはなんだかな。

余計なことを考えてしまった。このロードマップを考えるために一時間消えた。

ゴミ。時間の無駄。

まずはゲーム開発、次にCSV検索の方だろ。

恥を知れ恥を

## ゲーム

ゼノブレイド2とかモンハンライズサンブレとか割とやりこんでもいいかなとは考えてる。

しかし、金はそれなりにかかるのでう〜ん。

## 電子工作系

初心者キットの残りみたいなのはあるので、もう少し本格的な工作をしても良いかも。

やるとしたら基礎をしっかりと固めていきたい。

[当サイトに沿って学習する方法 - 実践で習得！電子回路](https://www.kairo-nyumon.com/learning_method.html)

[電子工作入門 - 基礎からの IoT 入門](https://iot.keicode.com/electronics/)

が、こちらでも何かやりたいみたいな強いものは特にない。


### === 日記(やる気がない) ===

[2022-06-19]

# 生存

やる気がないのでブログ読み直したりしてる。

# 日曜日から本気だした

というわけでカフェきてる。

軽くやったこと

* Arch更新
* ラズパイ再起動
* macOSのshellをzshへ変更(だるかったのでbashへと変えてた)

# bash,fish -> zsh?

流石にラズパイとかにはいれてないけど近頃zshへと移行が進んでおり、

fishはArchのノートPC二つだけとなっている。

zshはくそべんり。

fishは便利だけど、正直使いこなせている感じがしない。

故にfishいれてるArchもzshへ移行させるか迷ってる。

# 今日みた記事

## [Zinitでターミナルをカスタマイズする](https://zenn.dev/nagan/articles/8168ba0ca407ad)

macosでzshの設定をしていたときにzinitねーぞと怒られたので入れたときにみた記事。

## [ドキュメントに固執せよ - gfnweb](https://gfngfn.github.io/ja/posts/2022-06-18-be-a-documentation-geek/)

自分の経験と照らし合わせて自分の見える範囲の環境前提で考えて、まとめてみた。他は知らん。

### 共感した点

めんどいのでブログ本文(以下本文)から都合のいいとこだけ抜き出してる。

#### > コードの大部分は誰でも書ける

これはクローズドチームの話内部で全員同じレベルの場合その通りで

基本的に僕のコーディング自体は設計したものをただコードに落としているだけなので

むしろコード前の設計の部分が極めて重要なのでここを共有するのは間違いなく必須。

#### > そんな再発見をする必要はないし

本文でも腕時計で譬え話を書いてある通り、ドキュメントを初めて見る人間の立場になって考えてみると

再発見は間違いなく無駄な時間だ。

#### > ドキュメントで何よりも先に伝えなければならないのは「なぜつくったのか」「何を実現しているのか」「どう使えるのか」である．読者が追加で著者に質問することなくこれらを読み取れないドキュメントは事実上ドキュメントではないと言ってもよいかもしれない．

コードを見なくてもだいたい理解できるように「何を実現しているのか」、「どう仕えるのか」を

コードを見てもわからない箇所の補完をするために「なぜ作ったのか」を書いていく。

#### > 何がわからないのかがわからない

#### > 質問はコストが大きい

これは最近実感したことだ。

自分が経験した苦労をいつの間にか他の人に対しても経験させるようなことをしていた。

## [「勤務場所は自宅」「飛行機で出社OK」NTTが来月から新ルール](https://www3.nhk.or.jp/news/html/20220618/k10013677411000.html)

前職であれば僻みみたいなのが生まれていただろうけど、ほぼリモートの今ならもっとやれ感が強い。

一応ホームレス、生活保護ルート入る前に職探しははいるので、その際にリモート求人があればあるほど助かるのだ。

そもそもIT企業がリモートやらなくてどこがやるのか。対面やりたいやつは固まっててほしい。

なのでNECにそれが集まってくれるのは特に感情的なものはない。

## [イオンの秘密情報を週刊誌に漏えい　デロイトトーマツが謝罪　「社内ルールを逸脱した行為があった」 - ITmedia NEWS](https://www.itmedia.co.jp/news/articles/2206/17/news131.html)

1人のやらかしで甚大な被害が入るから大企業?は大変ですね。

## [GitHub - jiro4989/ojosama: テキストを壱百満天原サロメお嬢様風の口調に変換します](https://github.com/jiro4989/ojosama)


[ojosama/rule.go at c46abbd7b7fd845d4ac8d86cf9ad1bc6cc985787 · jiro4989/ojosama · GitHub](https://github.com/jiro4989/ojosama/blob/c46abbd7b7/rule.go)

機械学習をご採用されておりますの？とソースを見ておりましたが、結構強引な実装でおハーブ生えましてよ。

[Issues · jiro4989/ojosama · GitHub](https://github.com/jiro4989/ojosama/issues)

おissueもくすっときますわ。


### === 日記(マイクラとか) ===

[2022-06-04]

マイクラとなろうしかせん。

疲れたらアプリ書くくらいでいい。

ラズパイの再起動とArch系の更新は毎週入れてる。


### === 日記(不安定) ===

[2022-06-07]

最近 集中しようとすると眠くなるようなそれが結構強い。考え事すると寝てるみたいなことそこそこある。

あとメンタルがやばい。しばらく一人にしてほしい。仕事したくない


### === 日記(メンタル回復とか) ===

[2022-06-09]

メンタル回復した。

知り合い、友達がいないつらみみたいなことを少し感じた。

ただ、そんなもんかともなった。

なんで僕が無能なのかってのと友達がすぐ消える理由が割と近い推測をしている。

割と確信してる。でも改善みたいなことやる気も作戦も思いつかない。

僕は会社でもうんこでこの歳で実力もコミュニケーションもうんこなので明日には解雇されるしされなくても明後日には解雇されてる。

知らんけど。

プログラム書くことに全力になれない。

やっぱりご飯食べてる時が一番幸せだ。

死ぬとしたら、このまま暴食を続けて脳梗塞か糖尿病で死にたい。

それか吐瀉物を詰まらせて死にたい。

プログラムを書くのは楽しいけど、それ以上にご飯食べることが楽しい。

それ以外はカス。カスカス。カスカスカスカスカス。

自分の思い通りにいかないのが気に食わないのであればゲームとプログラムが当てはまらない。

そうでもないかも。わからん。

実際に大食いしている人たちがどのように大量の食事を処理しているのかわからん。

しかし、ご飯は食べ続けることができるならそうしたい。金銭的にも胃袋的にも余裕ならそれしたい。

でも僕は食べ続けると嘔吐する。幸せなのにな。

嘔吐よりも辛いのは人間コミュニケーション。嫌いではない。嬉しいし楽しい。

けど辛い。そう辛い。

返答が怖い。過呼吸になる。ミスが気になる。被害妄想が走る。

---

明日、日記と日報を読み返そう。

毎週金曜日だな。

---

日報、何をかけばいいのかわからなくなる。

結局一時間前の自分が何考えてたのかとか覚えてない。

そうなると、コメントとかmdに逐次に吐き出すのは大切じゃぁ。わしのアイディアじゃぁ...!


### === 日記(体調が悪い) ===

[2022-06-24]

偏頭痛がひどくて死んでた。

後なんか知らんが腹痛もひどくてダブル地獄だった。クソが。

進捗出したかったが、ダメだった。無念。


### === 日記(進捗モリモリうんこもりもり) ===

[2022-06-25]

朝から下痢便祭りだった。辛い。

---

ぽんぽんぺいんから復帰してからは朝からカフェをキメた。

そこでcompiew怒りの進捗コミット反映をキメキメの実モデルデブ覚醒して

世界一ふざけてた。

今から帰宅。

---

# ラズパイ整理

いつものリブートとArchの更新の合間にラズパイのclamav重すぎ問題へと対応を行った。


### === Emacsカスタム(2022/06/05) ===

[2022-06-05]


```lisp
(leaf counsel-tramp
  :ensure t
  :require t)

(leaf company-tabnine
  :ensure t
  :require t
  :config
  (setq company-idle-delay 0)
  (setq company-show-numbers t)
  (add-to-list 'company-backends #'company-tabnine))

```

tabnineはVSCodeでお世話になってるので入れた。

counsel-trampはいれただけ、使い方よくわかってない。

あとで消すかも。

ちなみに、company-tabinineは

M-x company-tabnine-install-binary

を実行しとかないと補完周りはエラーで止まるので注意。

あとweb-modeをjs,jsxと紐付けるのやめた。lspがうまく動かんのや。


```lisp

(leaf rjsx-mode
  :ensure t
  :require t
  :config
  (add-hook 'rjsx-mode-hook #'eglot))

(leaf lsp-mode
  :ensure t
  :require t
  :config
  (setq lsp-prefer-flymake nil)
  (setq lsp-rust-server 'rust-analyzer)
  :bind ("C-c h" . lsp-describe-thing-at-point)
  :hook ((php-mode . lsp)
		 (rust-mode . lsp))
  :commands lsp)

```

あとlsp-modeの部分を上記へと変更

lsp-modeのhookからweb-mode消した。


### === Next.jsのページ遷移とか ===

[2022-06-05]

## Next.jsでサイト内遷移させたい

### タグを生成する

```javascript
<Link href="/about">
	<a>こちら</a>
</Link>
```


### 関数実行時すぐに遷移する

```javascript
import { useRouter } from 'next/router'

...
const router = useRouter();


...

(url) => {
	router.push(url);
}
...
```

こちらでやりたいことはなんでもできそう。


### === Rubyクラス抽象化 ===

[2022-06-05]

nクラスの抽象化

ベースクラスと関数をmoduleを作成、

そのままモジュール化したけど、クラスにいれてもよかったもしれない。

```ruby

module Test

class Base
end
class A < Base
end
class B < Base
end



```


### === Rubyで環境変数読み込む ===

[2022-06-06]

```ruby

ENV["ENV"]

```

変数で速攻アクセスdできるのはいいね。


[object ENV (Ruby 3.1 リファレンスマニュアル)](https://docs.ruby-lang.org/ja/latest/class/ENV.html)


### === RubyによるCSV検索チューニング_ファイルインデックス修正 ===

[2022-06-08]

[linear_search module -&gt; class · wasuken/simple-csv-search@11fb776 · GitHub](https://github.com/wasuken/simple-csv-search/commit/11fb776fa4b907140ed039d0cb049e08868b8b5a)

大まかな修正としては

* module -> class
* Fileインデックスに行を直接書き込み -> CSV読まなくてもいいので結果的に早くなる。
  * 更新を考慮していない。

## 調査とか

```shell
wc -l db.csv
10552 db.csv
```

１万行程度のCSVで検証。

```ruby
require "csv"

rst = []
CSV.foreach("./db.csv", header: true) do |row|
  if rst["title"]
    rst << row
  end
end
```

```shell
% time ruby test.rb

________________________________________________________
Executed in    2.65 secs    fish           external
   usr time    2.47 secs    1.70 millis    2.46 secs
   sys time    0.14 secs    0.68 millis    0.14 secs
```

適当に調べたけどやはり全読み込みは遅い。

もっと大きいCSVで検証してみたい。

分割してデータアクセスすれば早そう

### 3000

```shell
% time ruby test.rb

________________________________________________________
Executed in    1.10 secs      fish           external
   usr time  939.29 millis    1.74 millis  937.55 millis
   sys time  124.87 millis    0.67 millis  124.20 millis


```

### 1000

```shell
% time ruby test.rb

________________________________________________________
Executed in  692.81 millis    fish           external
   usr time  565.85 millis    1.63 millis  564.22 millis
   sys time  105.90 millis    0.00 millis  105.90 millis


```

全部読み込む前提で考えると1000がラインかな。

## 次やること

* DB分割（パーティション的なやつ）

* 分割後のインデックス作成処理


### === RubyによるCSV検索チューニング_パーティションアプローチ ===

[2022-06-09]

[added v2 index search. · wasuken/simple-csv-search@7cdc719 · GitHub](https://github.com/wasuken/simple-csv-search/commit/7cdc7192e0c6de63be613669c278833fa73bb05d)

```shell
% bundle exec rspec spec/v2_search_spec.rb

Randomized with seed 54798

CSV検索V2
  サンプル検証
	first item title: ジョジョの奇妙な冒険
	items: 7
	first item title:
	items: 0
	first item title: 未来少年コナン
	items: 37
	first item title: 金田一少年の事件簿
	items: 6
	first item title: みんなのうた「何かいいことあるらしい」
	items: 10
	first item title: ジョジョの奇妙な冒険
	items: 7
	first item title:
	items: 0
	first item title: 未来少年コナン
	items: 37
	first item title: 金田一少年の事件簿
	items: 6
	first item title: みんなのうた「何かいいことあるらしい」
	items: 10
    テストデータ検証

Top 1 slowest examples (2.07 seconds, 99.9% of total time):
  CSV検索V2 サンプル検証 テストデータ検証
    2.07 seconds ./spec/v2_search_spec.rb:24

Finished in 2.08 seconds (files took 0.09393 seconds to load)
1 example, 0 failures

Randomized with seed 54798
```

前回記事より、分割するとのことなので分割機能は実装した。

ただまだ改善案は残ってて、

分割ファイルをすべて同時に開いて、同じ歩調で開く処理の方が基本的に早いのかなーという点、

パーティショニングしているので部分ファイルであればソートとかしてみてもよいかも。

あと実装的にはインデックスファイルの名前が他キーで作成した場合、かぶるなと。

## 疑問点、もやもやとか

### 関数共通処理

railsのbefore_action的なやつ

パーティションしてない場合partition関数以外弾くようにしている。

```ruby

if @part_csv_pathes.size <= 0
    raise Exception.new("not partition error")
end

```

これを一つにまとめたい。関数化して関数を一番上に配置しかないのだろうか。

### rspec共通処理

itをループで作成しようとしたら、失敗した。う〜む。

## 次やること

* 部分ファイル同時読み
* 部分ファイルサイズ調整(検証)


### === Markdown用のヘッダ生成関数修正(emacslisp文字列操作) ===

[2022-06-11]

```lisp
(defun format-yaml-lines (items indent)
  (if (car items)
	  (format "%s- \"%s\"
%s" indent (car items) (format-yaml-lines (cdr items) indent))
	""
	)
  )

(defun insert-hugo-header ()
  (interactive)
  (goto-char 0)
  (let* ((ts (format-time-string "%Y-%m-%d"))
		 (title (read-string "title: "))
		 (categories-str (read-string "categories(a,b): "))
		 (tags-str (read-string "tags(a,b): "))
		 (categories (split-string categories-str ","))
		 (tags (mapcar #'string-trim (split-string tags-str ",")))
		)
	(insert
	 (format "---
title: \"%s\"
description:
date: %s
draft: false
categories:
%s
tags:
%s
---
" title ts (format-yaml-lines categories "  ") (format-yaml-lines tags "  ")))
	)
  )


```

カテゴリとタグを入力できるように修正。

最後に空白が入ってしまうのはどうにかする。

```lisp
(defun format-yaml-lines (items indent)
  (string-join (mapcar #'(lambda (x) (format "%s- \"%s\"" indent x)) items) "
"))
```

これでよかったんや。


### === Tramp先のgoplsが見つからない ===

[2022-06-11]

```lisp
(leaf go-mode
  :ensure t
  :require t
  :config
  (add-hook 'before-save-hook 'gofmt-before-save)
  )

(leaf eglot
  :ensure t
  :require t
  :config
  (add-hook 'ruby-mode-hook #'eglot)
  (add-hook 'go-mode-hook #'eglot)
  )
```

ruby-mode-hookがrjsxの方にあったので移動。

上記だと動かない。確かPATHにねーぞって怒られた。

## 対応

リモートでgoplsのパス調べてそのままフルパス入力した。

zshやbash周りの設定確認したけどしっかり入ってた。


### === 分割CSVを並行して検索処理する ===

[2022-06-12]

やっていき。

処理としては

1. CSVファイルからIOを取得, CSV.newで
2. 配列へ格納。
3. 処理が終わるまで配列内部のIOを進め続けるとなる。

---

考えてみたけど効率化できなくね？となったので現在検証中。


### === テトリス書いてます！ ===

[2022-06-16]

[GitHub - wasuken/ts-tetris at dev](https://github.com/wasuken/ts-tetris/tree/dev)

# できてること

* ブロック移動
  * 左
  * 右
  * 下

手動かつバグとりができてない。

# できてないこと

* ブロック移動
  * 左
  * 右
  * 下
* 行消
* 複数色
* テトラミノランダム生成
* 時間(一秒ごとに落としたい)

# 学んだこと

```typescript
export type Rotate = 1 | 2 | 3 | 4;
```

1~4の型とかの定義できる。


あとはなるべくベースの関数,決めてそちら流れるように実装を心がけている。

rotate,moveBlock系は一応守れてる。


### === 他のテトリス実装を見てみる ===

[2022-06-19]


### === ブラウザで圧縮ファイルの中身を確認したい ===

[2022-06-19]

タイトルの通りなのでまずはローカルサービスとして書いていくぞ。

根本的には公開されているZipファイルを確認したかっただけなのでそこだけサポートするとすると

入力要件は下記となる。

* フロント: zipファイルのURLを入力する
* API: zipファイルのURLをパラメタとする
* 共通: ファイル種類はzipのみとする

描画自体は後でもよいのでAPIで再帰リストとして返却してくれればよい。

* API: ディレクトリ情報は再帰リストで返却
* フロント: ディレクトリツリーライブラリへレスポンスを入れる

とりあえずここまで書いてみる。

それ以降については上記ができてから考える。テトリスとか終わってないからね。

## 名前

compiew

## 実装機能

### ブラウジング(キャッシング->ブラウジングという流れ)

+ キャッシング
+ 外部サイトリンク経由でのダウンロード
+ 本サービス内部でダウンロード

### 部分操作

* 部分的にダウンロードする。
+ 改めてZip化等を行い、DL。

## インフラ

* backend: go
* frontend: typescript+react

開発/本番環境はDocker

# 開発一日目感想

一度フロントで完結するやつを作ろうとしたが、結果的にこれは以下の理由で大失敗だった。

* pakoというライブラリ(zlibのJS実装?)を利用したが、当然zipには非対応。

* gzファイルには当然対応しているが、ファイル名とかのパースはしてくれない。全部文字列で返却してくる。そのためパーサを書かないといけない。

上記に気がつくまで二時間ほどコード回してた。

諦めてバックエンドに飛ばそう...。


### === compiewフロントエンド開発 ===

[2022-06-20]

frontだけ書いた。

pakoでパースしているが、zipはパースできないようなので別ライブラリを利用する。

zlibjsかな。

全体の機能とか決めてないので見た目はまだシンプルなまま。


### === tetris ===

[2022-06-20]

[マップ移動周りのバグと左右移動実装 · wasuken/ts-tetris@2de19e4 · GitHub](https://github.com/wasuken/ts-tetris/commit/2de19e4ab5e439de939f01eec45d222f4c420456)

バグ修正とかこっそりやったくらい。

次あたりにやるかもしれないこと

* マップ上での回転
* 一番したへ落ちた判定
* 一番したに落ちた後の処理(再配置、終了判定等)


### === compiew: 一応zipとtar.gzのパースとフォルダツリー表示までできた。 ===

[2022-06-25]

# やったこと

* URL入力でもフォルダツリー表示できるようにした。
  + API: パース関数作成
  * Front: リクエスト処理作成

# 次やりたいこと

## セッション概念追加

後述

## URLダウンロードのキャッシング

download関数内部またはwrapした関数を作成する。

## tmpファイル名生成ロジック修正

URL+セッションIDでハッシュ値生成してそれをファイル名にする

### 用語説明

#### セッション

URLリクエスト時に作成、

削除要求リクエストがあればディレクトリ、DBデータ共に削除

一定期間更新ない場合もジョブで削除。

---

色々書いたけど、セッション周りがまだ煮詰まらないので

まずはURL単位のキャッシングを実装する。


### === tetris進捗 ===

[2022-06-25]

テトリスのマップ上というより回転についてずっと考えていた。


軸が重要な気がする。

[テトリミノの回転 | テトリスアルゴリズム | ActionScript | バンブーサテライツ](http://www.bamboo-satellites.com/as/tetris/tetris04.html)

ココらへん見ながらメモしてみた。

```
xxxxx
xxxxx
xxzxx
xooxx
xoxxx
```

x: 空白
o: ブロック
z: さっき出した軸。ブロックでもある。

zは動かさない。

oはzをもとに回転を入れる。

zは(2, 2)

zを除いたoの座標は

(3, 1), (3, 2), (4, 1)

となる。

zを中心に回転してみると

```
xxxxx
xxxxx
xxzox
xxxoo
xxxxx
```

となる。ここで仮定の話なのでnohaはみ出る無視する。

(3, 1)は(3, 3)

(3, 2)は(2, 3)

(4, 1)は(3, 4)

(2, 3), (3, 3), (3, 4)

```
xxxox
xxoox
xxzxx
xxxxx
xxxxx
```

(2, 3) => (1, 2)

(3, 3) => (1, 3)

(3, 4) => (0, 3)

(1, 2), (1, 3), (0, 3)

```
xxxxx
ooxxx
xozxx
xxxxx
xxxxx

```

(1, 2) => (2, 1)

(1, 3) => (1, 1)

(0, 3) => (1, 0)

(2, 1), (1, 1), (1, 0)

```
xxxxx
xxxxx
xxzxx
xooxx
xoxxx
```

---

# 座標について

マップ上から取得した座標を素直に利用すると回転機能の実装が難しくなる。

なのでzとの相対位置で計算した。

そして計算後に絶対位置へ戻した。

そこのかんたんなテストまで書いた。
