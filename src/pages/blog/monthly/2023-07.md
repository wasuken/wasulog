---
title: "月報[2023-07]"
layout: "../../../layouts/BlogPost.astro"
description: ""
date: "2023-07-11"
count: 5459
tags:
 - monthly
---




### === 復帰 ===

[2023-07-01]

昨日やりたかったけど、金曜日だったからやめた。

# rust

## File::openでwriteしようとした話

すでに他の人が記事かいてた。

[Rustでエラーが出てないのにファイルに書き出せないときは | κeenのHappy Hacκing Blog](https://keens.github.io/blog/2017/06/13/rustdeera_gadetenainonifairunikakidasenaitokiha/)

結論: File::createでひらけ。

記事にあるとおり、エラーとかでなくてひたすらprintln!デバッグしてた。




# wasulogのdeploy.sh修正した

[commit · wasuken/wasulog@957a447 · GitHub](https://github.com/wasuken/wasulog/commit/957a4471b7bf49db255eb6a2d83c00c64a51ff02)

文章化わすれてた。

前まで移動先でgit操作してたからうごかなかった。

だからpwdで元dirpath記憶しといて、複製後cdでもどってくる処理かいた。


### === whisperつかってみた ===

[2023-07-02]

# whisper.cpp

[GitHub - ggerganov/whisper.cpp: Port of OpenAI&#39;s Whisper model in C/C++](https://github.com/ggerganov/whisper.cpp)

これを家に半分くらいニートしてたPCでうごかしてみた。

まず、モデルのダウンロードをおこなう。まあおためしやしmediumつかうわ

```bash
$ ./models/download-ggml-model.sh medium
```

なお、wavファイルのフォーマットが16kHzじゃないとおこられたので変換を事前におこなっておく。

```bash
$ ffmpeg -i input.wav -acodec pcm_s16le -ac 1 -ar 16000 output.wav
```

実行。

```bash
$ ./main -m models/ggml-medium.bin -f ~/hoge.wav -l ja -txt -of ~/result
```

ちなみにドキュメントみおとしてたかもしれないが、

-ofにresult.txtとつけてたらresult.txt.txtになってたので拡張子はいらんっぽい。

# nvox

細々とやっとります。

## pagesにベタ書き -> componentとして作成 -> pages修正

これが俺の最新の折衷案。

うごくとこまではとにかく感覚でやる。

うごいたら即component化して、pagesからうつしたコード全般けして、参照するようにする。

## ts react

無限にわすれる。

[【React×TypeScript】イベントハンドラの型 - Qiita](https://qiita.com/y-suzu/items/9e9a243aaded5952834a)

```typescript
const [query, setQuery] = useState<strin>();
const handleChange = (e: React.ChangeEvent<HTMLInputElement>){   // <- これ
}
return (
<input value={query} onChange={handleChange}  />
)

```

button

[【TypeScript】Reactでのイベントに設定する型の理解が少しだけ深まる | アールエフェクト](https://reffect.co.jp/react/react-typescript-event/)

React.MouseEvent<HTMLButtonElement, MouseEvent>

ただ、buttonはだいたい省略するからそこまで困らない。

## flex-direction

flexで縦にしたい。

flex-direction: column;

よくわすれる。

[flex-direction - CSS: カスケーディングスタイルシート | MDN](https://developer.mozilla.org/ja/docs/Web/CSS/flex-direction)

## next.jsでmuiのセットアップ

ほぼreactやが

[Next.jsにMaterial UIを組み込んだ環境を作る](https://zenn.dev/ttani/articles/next-materialui-setup)

基本的に上。

[Next.jsに新しくなったMUI(Material-UI v5)とEmotionを導入して新機能を試す | ZUMA Lab](https://zuma-lab.com/posts/next-mui-emotion-settings)

上もemotionとかstyledのつかいかたしるためにみた。

俺はemotionよりstyledのがなれてた？からstyledつかった。なんかObjectっぽいかきかたになってたけど。

## [mui]slider

[React Slider component - Material UI](https://mui.com/material-ui/react-slider/)

サンプルコードのままにページングリストのコンポーネントつくった。

今回は挑戦的?でページングをこのsliderでやろうというわけだ。

サンプルコードどおりかいたのでそのとおりの動作はしてくれた。

後必要な機能としては

- defaultPageをpropsで指定できるように
- bookmarkIndexでしるしをつけたい。なんならdefaultPageいらないからこっちほしい。


### === ロッグマンエグゼ ===

[2023-07-03]

自動セーブしてそう。

# ibox

複数アップロードできるコンポーネントつくってさしかえた。

ローディング中のCSSとJSがうまくいってないからなおす。


### === うんち! ===

[2023-07-05]

# nvox

ようやっとおわった。

修正もいれた


### === シチュ系ASMR...いい ===

[2023-07-07]

# getInitPropsでDB処理したいときにでたやつ

厳密にはgetInitPropsの外でimportしたファイルで

new PrismaClient

っぽいことしてるとこでエラーがでてとまったときにした対応。

const {method} = require("path/to/file")

してやった。

でも

[wasuken/ibox](https://github.com/wasuken/ibox/blob/main/src/pages/group/%5Bid%5D.tsx)

以前かいたこのコードだと別にエラーはいてないはずなんだが、なんでだ？


### === ほげ ===

[2023-07-08]

# nvox

## 複合主キー

[Prismaで複合主キーを設定する](https://zenn.dev/kaz_z/articles/prisma-unique-key)

```js
model Hoge{
	id. ..
	huga  ...
	@@unique([id, huga], name: "hoge_identifier")
}
```


### === うすっぺらぺらのぺらぺらそーす ===

[2023-07-09]

# prisma

## selectで関連テーブルのデータも参照したい

[Prismaでリレーション先のデータもSELECTしたい場合のパラメータ覚書 | WP-kyoto](https://wp-kyoto.net/prisma-select-relational-table-data/)

上みて解決したよ。

カラムを部分的に取得したいときには

```typescript
const poyo = ...
const id = ...
...findMany({
	select: {
		poyo: true,
		hoge: {
			id: true,
		}
	},
	where: {
		poyo: poyo,
		hoge: {
			id: id,
		}
	}
})
```

こんなかんじ。

俺のかきかたとしてお世話になるのはほぼselectになりそう。

# [mui]modalつかう

[React Modal component - Material UI](https://mui.com/material-ui/react-modal/)

modalの中にmodalみたいなことも簡単にできるみたいだ。

# [mui]icon

[React Icon Component - Material UI](https://mui.com/material-ui/icons/)

color="primary"

みたいなかんじで色を変更できる。

後俺はすでにやってたけど、パッケージのインストールは事前におこなう必要がある。

```bash
$ npm install @mui/icons-material
```

[Material Icons - Material UI](https://mui.com/material-ui/material-icons/)

ちなみにここで検索できる。


### === 今日はなにしよう ===

[2023-07-10]

nvoxもiboxもおちついちゃったからあたらしいことさがす。

# elfeedいれる

今のEmacs環境にはなかったのでuse-packageとURLを追加。

```lisp
(use-package elfeed
  :ensure t
  :config
  (setq elfeed-feeds
	  '("https://b.hatena.ne.jp/hotentry/it.rss"
	"https://zenn.dev/feed"
	"https://zenn.dev/topics/rust/feed"
	"https://zenn.dev/topics/nextjs/feed"
	"https://zenn.dev/topics/solidjs/feed"
	"https://zenn.dev/topics/react/feed"
	)))
```

# rust/todo

わすれてた。

ひさしぶりに修正。

なんか追加すると別のtodoが削除される不具合がおきてたから調査した。

結論としてはtruncateいれてたことが原因だった。

コピペしてよくわからんままつかってた弊害。こいつほんまに職業プログラマか？

```rust
...
OpenOptions::new()
		.write(true)
		.truncate(true)  // こいつ!
		.append(true)
		.open(path)
...
```

.truncate(true)

公式docこと[OpenOptions in std::fs - Rust](https://doc.rust-lang.org/std/fs/struct.OpenOptions.html#method.truncate)によると

なんかきりつめるみたいだ。

[OpenOptions doesn&#39;t work when append=true and truncate=true on unix platforms · Issue #34347 · rust-lang/rust · GitHub](https://github.com/rust-lang/rust/issues/34347)

一緒につかう想定されてないなこれ。

# FileMode.truncateはじめてしった。

とおもったらこれ.netか。

[ファイルをオープンするときのモードを指定する（FileMode列挙型） | 日経クロステック（xTECH）](https://xtech.nikkei.com/it/article/COLUMN/20070206/260876/)

[【 truncate 】コマンド――ファイルを指定したサイズに変える](https://atmarkit.itmedia.co.jp/ait/articles/1712/01/news017.html)

truncateコマンドもある。sizeを0にきりつめるような動作だから一々filesystemでfileつくる動作しなくていいから

はやいってことか？

書き込みが発生するときに前の内容けしたいときにはいちいち削除とかするよりはこっちのほうがコードとしても

短くなって高速だからいいことづくめってことか。

# updateもされてねえ...


### === todoそろそろ狩るか... ===

[2023-07-11]

# nvox

微修正をいれた。privateリポジトリなので公開できる進捗は今日は皆無。

つまり今日の俺に価値はない。
